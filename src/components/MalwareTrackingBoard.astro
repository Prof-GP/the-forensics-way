---
// src/components/MalwareTrackingBoard.astro

// 1. IMPORT the data array from the separate file
import { initialSamples } from '../data/samples.ts'; 

// 2. Pass the data to the client-side script
const initialSamplesJson = JSON.stringify(initialSamples);
---

<div class="tracking-board">
  <div class="board-header">
    <div>
      <h2>Malware Analysis Pipeline</h2>
      <p class="board-subtitle">Track samples through our analysis workflow</p>
    </div>
    <button class="add-sample-btn" id="addSampleBtn">
      <span class="btn-icon">‚ûï</span>
      Add New Sample
    </button>
  </div>
  
  <div class="board-columns">
    <div class="board-column" data-status="submitted">
      <div class="column-header">
        <div class="column-icon">üì•</div>
        <div class="column-info">
          <h3>Submitted</h3>
          <p>Awaiting triage</p>
        </div>
        <span class="count" data-column="submitted">0</span>
      </div>
      <div class="column-content" id="submitted-column"></div>
    </div>
    
    <div class="board-column" data-status="analyzing">
      <div class="column-header">
        <div class="column-icon">üîç</div>
        <div class="column-info">
          <h3>Analyzing</h3>
          <p>Automated scanning</p>
        </div>
        <span class="count" data-column="analyzing">0</span>
      </div>
      <div class="column-content" id="analyzing-column"></div>
    </div>
    
    <div class="board-column" data-status="in-progress">
      <div class="column-header">
        <div class="column-icon">‚öôÔ∏è</div>
        <div class="column-info">
          <h3>In Progress</h3>
          <p>Manual analysis</p>
        </div>
        <span class="count" data-column="in-progress">0</span>
      </div>
      <div class="column-content" id="in-progress-column"></div>
    </div>
    
    <div class="board-column" data-status="completed">
      <div class="column-header">
        <div class="column-icon">‚úÖ</div>
        <div class="column-info">
          <h3>Completed</h3>
          <p>Analysis published</p>
        </div>
        <span class="count" data-column="completed">0</span>
      </div>
      <div class="column-content" id="completed-column"></div>
    </div>
  </div>
</div>

<!-- Add Sample Modal -->
<div class="modal" id="addSampleModal">
  <div class="modal-backdrop"></div>
  <div class="modal-content">
    <div class="modal-header">
      <h3>‚ûï Add Malware Sample</h3>
      <button class="close-btn" id="closeModal">&times;</button>
    </div>
    <form id="addSampleForm">
      <div class="form-group">
        <label for="sampleName">
          Sample Name <span class="required">*</span>
        </label>
        <input 
          type="text" 
          id="sampleName" 
          required 
          placeholder="e.g., suspicious_document.exe"
          autocomplete="off"
        >
        <small>The filename or identifier for this sample</small>
      </div>
      
      <div class="form-group">
        <label for="sha256">
          SHA256 Hash <span class="required">*</span>
        </label>
        <input 
          type="text" 
          id="sha256" 
          required 
          placeholder="Enter 64-character SHA256 hash" 
          pattern="[a-fA-F0-9]{64}"
          maxlength="64"
          autocomplete="off"
        >
        <small>Must be exactly 64 hexadecimal characters</small>
      </div>
      
      <div class="form-group">
        <label for="description">
          Description <span class="required">*</span>
        </label>
        <textarea 
          id="description" 
          required 
          rows="4" 
          placeholder="Describe the sample's behavior, source, or characteristics..."
        ></textarea>
        <small>Provide context about where/how the sample was found</small>
      </div>
      
      <div class="form-group">
        <label for="family">
          Malware Family
        </label>
        <input 
          type="text" 
          id="family" 
          placeholder="e.g., Trojan.Generic, Ransomware.Locky"
          autocomplete="off"
        >
        <small>Classification if known (leave blank if unknown)</small>
      </div>
      
      <div class="form-actions">
        <button type="button" class="btn-secondary" id="cancelBtn">
          Cancel
        </button>
        <button type="submit" class="btn-primary">
          <span class="btn-icon">‚úì</span>
          Add Sample
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Card Detail Modal -->
<div class="modal" id="cardDetailModal">
  <div class="modal-backdrop"></div>
  <div class="modal-content modal-detail">
    <div class="modal-header">
      <h3>üìã Sample Details</h3>
      <button class="close-btn" id="closeDetailModal">&times;</button>
    </div>
    <div id="cardDetailContent"></div>
  </div>
</div>

<!-- Edit Modal -->
<div class="modal" id="editModal">
  <div class="modal-backdrop"></div>
  <div class="modal-content">
    <div class="modal-header">
      <h3>‚úèÔ∏è Edit Sample</h3>
      <button class="close-btn" id="closeEditModal">&times;</button>
    </div>
    <form id="editSampleForm">
      <input type="hidden" id="editSampleId">
      <div class="form-group">
        <label>Sample Name</label>
        <p id="editSampleName" class="form-display-text"></p> 
        <small>This is the name of the sample being edited.</small>
      </div>
      <div class="form-group">
        <label for="editAnalysisLink">
          Analysis Report Link
        </label>
        <input 
          type="url" 
          id="editAnalysisLink" 
          placeholder="https://example.com/analysis-report"
          autocomplete="off"
        >
        <small>Add a link to the published analysis (optional)</small>
      </div>
      
      <div class="form-actions">
        <button type="button" class="btn-secondary" id="cancelEditBtn">
          Cancel
        </button>
        <button type="submit" class="btn-primary">
          <span class="btn-icon">‚úì</span>
          Save Changes
        </button>
      </div>
    </form>
  </div>
</div>

<div id="server-data" style="display: none;">
  {initialSamplesJson}
</div>

<script>
  interface MalwareSample {
    id: string;
    name: string;
    sha256: string;
    description: string;
    family?: string;
    analysisLink?: string;
    status: 'submitted' | 'analyzing' | 'in-progress' | 'completed';
    dateAdded: string;
    lastUpdated: string;
  }

  let samples: MalwareSample[] = [];

  // --- Helper Functions ---

  // Escape HTML to prevent XSS and ensure proper text display
  function escapeHtml(text: string | undefined): string {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }
  
  // Get status label
  function getStatusLabel(status: string): string {
    const labels: Record<string, string> = {
      'submitted': 'üì• Submitted',
      'analyzing': 'üîç Analyzing',
      'in-progress': '‚öôÔ∏è In Progress',
      'completed': '‚úÖ Completed'
    };
    return labels[status] || status;
  }

  // Update counts
  function updateCounts() {
    const counts = samples.reduce((acc, sample) => {
      acc[sample.status] = (acc[sample.status] || 0) + 1;
      return acc;
    }, {} as Record<string, number>);
    document.querySelectorAll('.count').forEach((el) => {
      const column = (el as HTMLElement).dataset.column;
      if (column) {
        el.textContent = String(counts[column] || 0);
      }
    });
  }

  // --- Storage Functions (using localStorage) ---

  // Load samples from localStorage
  async function loadSamples() {
    try {
      const loadedSamples = [];
      // Loop through all items in localStorage
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith('malware-sample:')) {
          try {
            const data = localStorage.getItem(key);
            loadedSamples.push(data ? JSON.parse(data) : null);
          } catch {
            // Ignore bad/corrupted data
          }
        }
      }
      
      samples = loadedSamples.filter(s => s !== null);
      renderBoard();
    } catch (error) {
      console.error('Error loading samples:', error);
      samples = [];
      renderBoard();
    }
  }

  // Save sample to localStorage
  async function saveSample(sample: MalwareSample) {
    try {
      localStorage.setItem(
        `malware-sample:${sample.id}`,
        JSON.stringify(sample)
      );
      return true;
    } catch (error) {
      console.error('Error saving sample:', error);
      // This alert usually means localStorage is blocked (e.g., in private mode)
      alert('Failed to save sample. Please check browser settings or exit private mode.');
      return false;
    }
  }

  // Delete sample from localStorage
  function deleteSample(id: string) {
    if (confirm('Are you sure you want to delete this sample? This change will be temporary until you update the source file.')) {
      samples = samples.filter(s => s.id !== id);
      renderBoard();
      
      // LOG THE UPDATED ARRAY TO THE CONSOLE
      console.log('--- UPDATED SAMPLES ARRAY AFTER DELETION ---');
      console.log(JSON.stringify(samples, null, 2));
      console.log('----------------------------------------------------');
    }
  }
  // --- Card and Board Rendering ---

  // Create a card element
  function createCard(sample: MalwareSample): HTMLElement {
    const card = document.createElement('div');
    card.className = 'sample-card';
    card.draggable = true;
    card.dataset.id = sample.id;
    
    const truncatedHash = `${sample.sha256.substring(0, 12)}...${sample.sha256.substring(52)}`;
    const date = new Date(sample.lastUpdated).toLocaleDateString('en-US', {
      month: 'short',
      day: 'numeric',
      year: 'numeric'
    });

    // We build the inner HTML as a string
    const cardContent = `
      <div class="card-top">
        <div class="card-title-section">
          <div class="file-icon">üìÑ</div>
          <div class="title-text">
            <h4>${escapeHtml(sample.name)}</h4>
            ${sample.family ?
    `<span class="family-badge">${escapeHtml(sample.family)}</span>` : '<span class="family-badge unknown">Unknown Family</span>'}
          </div>
        </div>
        <div class="card-menu">
          <button class="menu-btn" title="Options">‚ãÆ</button>
        </div>
      </div>
      
      <div class="card-body">
        <div class="info-row">
          <span class="info-label">Hash:</span>
          <code class="hash-short" title="${sample.sha256}">${truncatedHash}</code>
        </div>
        
        <div class="info-row description-row">
          <span class="info-label">Description:</span>
          <p class="description-text">${escapeHtml(sample.description)}</p>
        </div>
        
        ${sample.analysisLink ?
    `
          <div class="info-row">
            <span class="info-label">Report:</span>
            <a href="${escapeHtml(sample.analysisLink)}" target="_blank" rel="noopener noreferrer" class="report-link">
              View Analysis ‚Üí
            </a>
          </div>
        ` : sample.status === 'completed' ?
    `
          <div class="info-row">
            <span class="info-label">Report:</span>
            <span class="no-report">No report yet</span>
          </div>
        ` : ''}
      </div>
      
      <div class="card-footer">
        <div class="footer-left">
          <span class="date-badge">üìÖ ${date}</span>
        </div>
        <div class="footer-right">
          <button class="icon-btn view-btn" title="View Details">üëÅÔ∏è</button>
          <button class="icon-btn move-btn" title="Move">‚ÜîÔ∏è</button>
        </div>
      </div>
    `;

    // Crucial step: Set the innerHTML of the card element
    card.innerHTML = cardContent;

    // Menu button
    card.querySelector('.menu-btn')?.addEventListener('click', (e) => {
      e.stopPropagation();
      showCardMenu(sample, e.target as HTMLElement);
    });
    // View button
    card.querySelector('.view-btn')?.addEventListener('click', (e) => {
      e.stopPropagation();
      showCardDetail(sample);
    });
    // Move button
    card.querySelector('.move-btn')?.addEventListener('click', (e) => {
      e.stopPropagation();
      showMoveMenu(sample, e.target as HTMLElement);
    });
    // Click card to view details
    card.addEventListener('click', () => {
      showCardDetail(sample);
    });
    // Drag events
    card.addEventListener('dragstart', handleDragStart);
    card.addEventListener('dragend', handleDragEnd);

    return card;
  }

  // Render the board
  function renderBoard() {
    const columns = {
      'submitted': document.getElementById('submitted-column'),
      'analyzing': document.getElementById('analyzing-column'),
      'in-progress': document.getElementById('in-progress-column'),
      'completed': document.getElementById('completed-column')
    };
    // Clear all columns
    Object.values(columns).forEach(col => {
      if (col) col.innerHTML = '';
    });
    // Sort by date (newest first)
    const sortedSamples = [...samples].sort((a, b) => 
      new Date(b.lastUpdated).getTime() - new Date(a.lastUpdated).getTime()
    );
    // Add cards to columns
    sortedSamples.forEach(sample => {
      const column = columns[sample.status];
      if (column) {
        // Crucial: Append the newly created HTML element
        column.appendChild(createCard(sample));
      }
    });
    // Update counts
    updateCounts();
  }

  // --- Drag and Drop Handlers ---
  
  let draggedElement: HTMLElement | null = null;

  function handleDragStart(this: HTMLElement, e: DragEvent) {
    // FIX: Correctly setting the global variable
    draggedElement = this; 
    this.classList.add('dragging');
    if (e.dataTransfer) {
      e.dataTransfer.effectAllowed = 'move';
    }
  }

  function handleDragEnd(this: HTMLElement) {
    this.classList.remove('dragging');
    draggedElement = null;
  }

  // Move sample to new status
  async function moveSample(id: string, newStatus: MalwareSample['status']) {
    const sample = samples.find(s => s.id === id);
    if (sample) {
      sample.status = newStatus;
      sample.lastUpdated = new Date().toISOString();
      renderBoard();
      
      // LOG THE UPDATED ARRAY TO THE CONSOLE for you to copy
      console.log('--- UPDATED SAMPLES ARRAY READY FOR COMMIT ---');
      console.log('Copy this JSON array and paste it into src/data/samples.ts');
      console.log(JSON.stringify(samples, null, 2));
      console.log('----------------------------------------------------');
    }
  }

  // --- Menu and Modal Functions ---

  // Show card menu
  function showCardMenu(sample: MalwareSample, button: HTMLElement) {
    const menu = document.createElement('div');
    menu.className = 'context-menu';
    
    menu.innerHTML = `
      <button data-action="edit">‚úèÔ∏è Edit</button>
      <button data-action="copy">üìã Copy Hash</button>
      <button data-action="delete" class="danger">üóëÔ∏è Delete</button>
    `;
    menu.addEventListener('click', async (e) => {
      const target = e.target as HTMLElement;
      const action = target.dataset.action;
      
      if (action === 'edit') {
        showEditModal(sample);
      } else if (action === 'copy') {
        await navigator.clipboard.writeText(sample.sha256);
        alert('Hash copied to clipboard!');
      } else if (action === 'delete') {
        if (confirm('Are you sure you want to delete this sample?')) {
          await deleteSample(sample.id);
        }
      }
      
      menu.remove();
    });
    // Position menu
    const rect = button.getBoundingClientRect();
    menu.style.top = `${rect.bottom + 5}px`;
    menu.style.left = `${rect.left - 150}px`;
    document.body.appendChild(menu);
    
    // Close on outside click
    setTimeout(() => {
      document.addEventListener('click', function closeMenu(e) {
        if (!menu.contains(e.target as Node)) {
          menu.remove();
          document.removeEventListener('click', closeMenu);
        }
      });
    }, 10);
  }

  // Show edit modal
  function showEditModal(sample: MalwareSample) {
    const modal = document.getElementById('editModal');
    
    // Set the visible fields for reference (This targets the new HTML element)
    (document.getElementById('editSampleName') as HTMLElement).textContent = sample.name;

    // Populate the form fields with the current sample data
    (document.getElementById('editSampleId') as HTMLInputElement).value = sample.id;
    (document.getElementById('editAnalysisLink') as HTMLInputElement).value = sample.analysisLink || '';
    
    modal?.classList.add('active');
  }

  // Show card detail modal
  function showCardDetail(sample: MalwareSample) {
    const modal = document.getElementById('cardDetailModal');
    const content = document.getElementById('cardDetailContent');
    
    if (modal && content) {
      content.innerHTML = `
        <div class="detail-grid">
          <div class="detail-card">
            <div class="detail-header">
              <span class="detail-icon">üìÑ</span>
              <h4>Sample Information</h4>
            </div>
            <div class="detail-item">
              <label>Sample Name:</label>
              <p class="detail-value">${escapeHtml(sample.name)}</p>
            </div>
            <div class="detail-item">
              <label>Malware Family:</label>
              <p class="detail-value">${sample.family ?
    escapeHtml(sample.family) : '<span class="unknown-text">Unknown</span>'}</p>
            </div>
          </div>

          <div class="detail-card">
            <div class="detail-header">
              <span class="detail-icon">üîê</span>
              <h4>Hash Information</h4>
            </div>
            <div class="detail-item">
              <label>SHA256:</label>
              <div class="hash-container">
                <code class="full-hash">${sample.sha256}</code>
                <button class="copy-hash-btn" data-hash="${sample.sha256}">üìã Copy</button>
              </div>
            </div>
          </div>

          <div class="detail-card full-width">
            <div class="detail-header">
              <span class="detail-icon">üìù</span>
              <h4>Description</h4>
            </div>
            <div class="detail-item">
              <p class="description-full">${escapeHtml(sample.description)}</p>
            </div>
          </div>

          <div class="detail-card">
            <div class="detail-header">
              <span class="detail-icon">üìä</span>
              <h4>Analysis Status</h4>
            </div>
            <div class="detail-item">
              <label>Current Status:</label>
              <p class="status-badge status-${sample.status}">${getStatusLabel(sample.status)}</p>
            </div>
            ${sample.analysisLink ?
    `
              <div class="detail-item">
                <label>Analysis Report:</label>
                <a href="${escapeHtml(sample.analysisLink)}" target="_blank" rel="noopener noreferrer" class="detail-link">
                  View Full Report ‚Üí
                </a>
              </div>
            ` : sample.status === 'completed' ?
    `
              <div class="detail-item">
                <label>Analysis Report:</label>
                <p class="detail-value no-link">Report not yet published</p>
              </div>
            ` : ''}
          </div>

          <div class="detail-card">
            <div class="detail-header">
              <span class="detail-icon">üìÖ</span>
              <h4>Timeline</h4>
            </div>
            <div class="detail-item">
              <label>Date Submitted:</label>
              <p class="detail-value">${new Date(sample.dateAdded).toLocaleString()}</p>
            </div>
            <div class="detail-item">
              <label>Last Updated:</label>
              <p class="detail-value">${new Date(sample.lastUpdated).toLocaleString()}</p>
            </div>
          </div>
        </div>
      `;
      // Add copy functionality
      content.querySelectorAll('.copy-hash-btn').forEach(btn => {
        btn.addEventListener('click', async () => {
          const hash = (btn as HTMLElement).dataset.hash;
          if (hash) {
            await navigator.clipboard.writeText(hash);
            const originalText = btn.textContent;
            btn.textContent = '‚úì Copied!';
            setTimeout(() => {
              btn.textContent = originalText;
            }, 2000);
          }
        });
      });
      modal.classList.add('active');
    }
  }

  // Show move menu
  function showMoveMenu(sample: MalwareSample, button: HTMLElement) {
    const statuses = [
      { value: 'submitted', label: 'üì• Submitted', color: '#3498db' },
      { value: 'analyzing', label: 'üîç Analyzing', color: '#f39c12' },
      { value: 'in-progress', label: '‚öôÔ∏è In Progress', color: '#e74c3c' },
      { value: 'completed', label: '‚úÖ Completed', color: '#2ecc71' }
    ];
    const menu = document.createElement('div');
    menu.className = 'move-menu';
    menu.innerHTML = `
      <div class="menu-header">Move to:</div>
      ${statuses
        .filter(s => s.value !== sample.status)
        .map(s => `
          <button data-status="${s.value}" style="border-left: 4px solid ${s.color}">
            ${s.label}
          </button>
        `)
        .join('')}
    `;

    menu.addEventListener('click', async (e) => {
      const target = e.target as HTMLElement;
      if (target.tagName === 'BUTTON') {
        const newStatus = target.dataset.status as MalwareSample['status'];
        await moveSample(sample.id, newStatus);
        menu.remove();
      }
    });
    // Position menu
    const rect = button.getBoundingClientRect();
    menu.style.top = `${rect.bottom + 5}px`;
    menu.style.right = `${window.innerWidth - rect.right}px`;
    document.body.appendChild(menu);
    
    // Close on outside click
    setTimeout(() => {
      document.addEventListener('click', function closeMenu(e) {
        if (!menu.contains(e.target as Node)) {
          menu.remove();
          document.removeEventListener('click', closeMenu);
        }
      });
    }, 10);
  }

  // --- Initialization ---

  document.addEventListener('DOMContentLoaded', () => {
    const addBtn = document.getElementById('addSampleBtn');
    const modal = document.getElementById('addSampleModal');
    const closeBtn = document.getElementById('closeModal');
    const cancelBtn = document.getElementById('cancelBtn');
    const form = document.getElementById('addSampleForm') as HTMLFormElement;
    const detailModal = document.getElementById('cardDetailModal');
    const closeDetailBtn = document.getElementById('closeDetailModal');
    const editModal = document.getElementById('editModal');
    const closeEditBtn = document.getElementById('closeEditModal');
    const cancelEditBtn = document.getElementById('cancelEditBtn');
    const editForm = document.getElementById('editSampleForm') as HTMLFormElement;
    const dataElement = document.getElementById('server-data');
    if (dataElement) {
        samples = JSON.parse(dataElement.textContent || '[]');
    }
    renderBoard();

    // Add sample modal
    addBtn?.addEventListener('click', () => {
      modal?.classList.add('active');
    });

    closeBtn?.addEventListener('click', () => {
      modal?.classList.remove('active');
      form?.reset();
    });

    cancelBtn?.addEventListener('click', () => {
      modal?.classList.remove('active');
      form?.reset();
    });
    // Detail modal
    closeDetailBtn?.addEventListener('click', () => {
      detailModal?.classList.remove('active');
    });
    // Edit modal
    closeEditBtn?.addEventListener('click', () => {
      editModal?.classList.remove('active');
      editForm?.reset();
    });
    cancelEditBtn?.addEventListener('click', () => {
      editModal?.classList.remove('active');
      editForm?.reset();
    });
    // Close modals on backdrop click
    document.querySelectorAll('.modal').forEach(m => {
      m.querySelector('.modal-backdrop')?.addEventListener('click', () => {
        m.classList.remove('active');
      });
    });
    
    // Add sample form SUBMIT
    form?.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const newSample: MalwareSample = {
        id: Date.now().toString(),
        name: (document.getElementById('sampleName') as HTMLInputElement).value.trim(),
        sha256: (document.getElementById('sha256') as HTMLInputElement).value.toLowerCase().trim(),
        description: (document.getElementById('description') as HTMLTextAreaElement).value.trim(),
        family: (document.getElementById('family') as HTMLInputElement).value.trim() || undefined,
        status: 'submitted',
        dateAdded: new Date().toISOString(),
        lastUpdated: new Date().toISOString()
      };

      // In this static workflow, we add it to the live array and render
      samples.push(newSample);
      renderBoard();
      
      // Log the NEW sample for you to copy and paste into src/data/samples.ts
      console.log('--- NEW SAMPLE ADDED LIVE ---');
      console.log('Copy this object and paste it into the src/data/samples.ts array:');
      console.log(JSON.stringify(newSample, null, 2));
      console.log('----------------------------------------------------');

      modal?.classList.remove('active');
      form.reset();
    });
    
    // Edit sample form SUBMIT
    editForm?.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const sampleId = (document.getElementById('editSampleId') as HTMLInputElement).value;
      const analysisLink = (document.getElementById('editAnalysisLink') as HTMLInputElement).value.trim();
      
      const sample = samples.find(s => s.id === sampleId);
      if (sample) {
        sample.analysisLink = analysisLink || undefined;
        sample.lastUpdated = new Date().toISOString();
        
        // Render the change on screen
        renderBoard();

        // Log the UPDATED array for you to copy and paste into src/data/samples.ts
        console.log('--- SAMPLES UPDATED AFTER EDIT ---');
        console.log(JSON.stringify(samples, null, 2));
        console.log('----------------------------------------------------');

        editModal?.classList.remove('active');
        editForm.reset();
      }
    });
    
    // Set up column drop zones
    document.querySelectorAll('.column-content').forEach(column => {
      column.addEventListener('dragover', (e) => {
        e.preventDefault();
        const dragging = document.querySelector('.dragging');
        if (dragging && column.contains(dragging) === false) {
          column.classList.add('drag-over');
        }
      });

      column.addEventListener('dragleave', () => {
        column.classList.remove('drag-over');
      });

      column.addEventListener('drop', async (e) => {
        e.preventDefault();
        column.classList.remove('drag-over');
        
        if (draggedElement) {
          const sampleId = draggedElement.dataset.id;
          const newStatus = column.id.replace('-column', '') as MalwareSample['status'];
          if (sampleId) {
            await moveSample(sampleId, newStatus);
          }
        }
      });
    });
  });
</script>

<style is:global>
  .tracking-board {
    padding: 2rem 0;
  }
  
  .board-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2.5rem;
    flex-wrap: wrap;
    gap: 1.5rem;
  }
  
  .board-header h2 {
    margin: 0 0 0.25rem 0;
    font-size: 2rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  .board-subtitle {
    margin: 0;
    color: #666;
    font-size: 1rem;
  }
  
  .add-sample-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 1rem 2rem;
    border-radius: 8px;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .add-sample-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
  }
  
  .btn-icon {
    font-size: 1.2rem;
  }
  
  .board-columns {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 2rem;
  }
  
  .board-column {
    background: linear-gradient(to bottom, #f8f9fa 0%, #ffffff 100%);
    border-radius: 12px;
    padding: 1.5rem;
    min-height: 500px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    border: 2px solid #e9ecef;
  }
  
  .column-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 3px solid #e9ecef;
  }
  
  .column-icon {
    font-size: 2rem;
    flex-shrink: 0;
  }
  
  .column-info {
    flex: 1;
  }
  
  .column-info h3 {
    margin: 0 0 0.25rem 0;
    font-size: 1.2rem;
    color: #333;
  }
  
  .column-info p {
    margin: 0;
    font-size: 0.85rem;
    color: #999;
  }
  
  .count {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
padding: 0.5rem 1rem;
border-radius: 20px;
font-size: 0.9rem;
font-weight: 700;
min-width: 40px;
text-align: center;
box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3);
}
.column-content {
display: flex;
flex-direction: column;
gap: 1.25rem;
min-height: 350px;
transition: background 0.3s;
}
.column-content.drag-over {
background: rgba(102, 126, 234, 0.05);
border-radius: 8px;
}
/* Sample Card Styles */
.sample-card {
background: white;
border-radius: 10px;
padding: 1.25rem;
box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
cursor: pointer;
transition: all 0.3s;
border-left: 4px solid #667eea;
}
.sample-card:hover {
transform: translateY(-4px);
box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
}
.sample-card.dragging {
opacity: 0.6;
transform: rotate(3deg);
}
.card-top {
display: flex;
justify-content: space-between;
align-items: flex-start;
margin-bottom: 1rem;
gap: 0.75rem;
}
.card-title-section {
display: flex;
gap: 0.75rem;
align-items: flex-start;
flex: 1;
min-width: 0;
}
.file-icon {
font-size: 1.75rem;
flex-shrink: 0;
}
.title-text {
flex: 1;
min-width: 0;
}
.title-text h4 {
margin: 0 0 0.5rem 0;
font-size: 1.1rem;
color: #333;
word-break: break-word;
}
.family-badge {
display: inline-block;
background: linear-gradient(135deg, #ffd32a 0%, #ffaa00 100%);
color: #333;
padding: 0.25rem 0.75rem;
border-radius: 12px;
font-size: 0.75rem;
font-weight: 700;
text-transform: uppercase;
}
.family-badge.unknown {
background: #e9ecef;
color: #6c757d;
}
.card-menu {
display: flex;
align-items: center;
}
.menu-btn {
background: none;
border: none;
font-size: 1.5rem;
cursor: pointer;
color: #999;
padding: 0.25rem 0.5rem;
transition: color 0.2s;
}
.menu-btn:hover {
color: #333;
}
.card-body {
display: flex;
flex-direction: column;
gap: 0.75rem;
margin-bottom: 1rem;
padding: 1rem 0;
border-top: 1px solid #f0f0f0;
border-bottom: 1px solid #f0f0f0;
}
.info-row {
display: flex;
flex-direction: column;
gap: 0.25rem;
}
.info-label {
font-size: 0.75rem;
color: #999;
font-weight: 600;
text-transform: uppercase;
letter-spacing: 0.5px;
}
.hash-short {
font-family: 'Courier New', monospace;
font-size: 0.85rem;
color: #667eea;
background: #f8f9fa;
padding: 0.5rem;
border-radius: 4px;
word-break: break-all;
}
.description-row {
margin-top: 0.5rem;
}
.description-text {
font-size: 0.9rem;
color: #666;
line-height: 1.5;
margin: 0;
display: -webkit-box;
-webkit-line-clamp: 3;
-webkit-box-orient: vertical;
overflow: hidden;
}
.report-link {
color: #667eea;
text-decoration: none;
font-weight: 600;
font-size: 0.9rem;
display: inline-flex;
align-items: center;
gap: 0.25rem;
transition: color 0.2s;
}
.report-link:hover {
color: #764ba2;
text-decoration: underline;
}
.no-report {
font-size: 0.85rem;
color: #999;
font-style: italic;
}
.card-footer {
display: flex;
justify-content: space-between;
align-items: center;
gap: 1rem;
}
.footer-left,
.footer-right {
display: flex;
align-items: center;
gap: 0.5rem;
}
.date-badge {
font-size: 0.8rem;
color: #666;
display: flex;
align-items: center;
gap: 0.25rem;
}
.icon-btn {
background: #f8f9fa;
border: 1px solid #e9ecef;
border-radius: 6px;
padding: 0.5rem;
cursor: pointer;
font-size: 1rem;
transition: all 0.2s;
}
.icon-btn:hover {
background: #e9ecef;
transform: scale(1.1);
}
/* Context Menu */
.context-menu,
.move-menu {
position: fixed;
background: white;
border-radius: 8px;
box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
padding: 0.5rem;
z-index: 2000;
min-width: 180px;
}
.context-menu button,
.move-menu button {
display: block;
width: 100%;
padding: 0.75rem 1rem;
border: none;
background: none;
text-align: left;
cursor: pointer;
border-radius: 4px;
transition: background 0.2s;
font-size: 0.95rem;
color: #333;
}
.context-menu button:hover,
.move-menu button:hover {
background: #f8f9fa;
}
.context-menu button.danger {
color: #dc3545;
}
.context-menu button.danger:hover {
background: #fff5f5;
}
.move-menu .menu-header {
padding: 0.5rem 1rem;
font-size: 0.8rem;
color: #999;
text-transform: uppercase;
font-weight: 600;
letter-spacing: 0.5px;
}
/* Modal Styles */
.modal {
display: none;
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
z-index: 1000;
align-items: center;
justify-content: center;
padding: 1rem;
}
.modal.active {
display: flex;
}
.modal-backdrop {
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: rgba(0, 0, 0, 0.6);
backdrop-filter: blur(4px);
}
.modal-content {
position: relative;
background: white;
border-radius: 12px;
max-width: 600px;
width: 100%;
max-height: 90vh;
overflow-y: auto;
z-index: 1001;
box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
}
.modal-detail {
max-width: 900px;
}
.modal-header {
display: flex;
justify-content: space-between;
align-items: center;
padding: 1.5rem;
border-bottom: 2px solid #f0f0f0;
background: linear-gradient(to right, #f8f9fa 0%, #ffffff 100%);
}
.modal-header h3 {
margin: 0;
font-size: 1.5rem;
color: #333;
}
.close-btn {
background: none;
border: none;
font-size: 2rem;
cursor: pointer;
color: #999;
width: 40px;
height: 40px;
display: flex;
align-items: center;
justify-content: center;
border-radius: 50%;
transition: all 0.2s;
}
.close-btn:hover {
background: #f0f0f0;
color: #333;
}
/* Form Styles */
form {
padding: 2rem;
}
.form-group {
margin-bottom: 1.5rem;
}
.form-group label {
display: block;
margin-bottom: 0.5rem;
font-weight: 600;
color: #333;
font-size: 0.95rem;
}
.required {
color: #dc3545;
}
.form-group input,
.form-group textarea {
width: 100%;
padding: 0.875rem;
border: 2px solid #e9ecef;
border-radius: 6px;
font-size: 1rem;
font-family: inherit;
transition: all 0.2s;
}
.form-group input:focus,
.form-group textarea:focus {
outline: none;
border-color: #667eea;
box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}
.form-group small {
display: block;
margin-top: 0.5rem;
font-size: 0.85rem;
color: #6c757d;
}
.form-actions {
display: flex;
gap: 1rem;
justify-content: flex-end;
margin-top: 2rem;
}
.btn-primary,
.btn-secondary {
padding: 0.875rem 2rem;
border: none;
border-radius: 8px;
font-weight: 600;
font-size: 1rem;
cursor: pointer;
transition: all 0.3s;
display: flex;
align-items: center;
gap: 0.5rem;
}
.btn-primary {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}
.btn-primary:hover {
transform: translateY(-2px);
box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}
.btn-secondary {
background: #e9ecef;
color: #333;
}
.btn-secondary:hover {
background: #dee2e6;
}
/* Detail Modal Content */
#cardDetailContent {
padding: 2rem;
}
.detail-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
gap: 1.5rem;
}
.detail-card {
background: #f8f9fa;
border-radius: 10px;
padding: 1.5rem;
border-left: 4px solid #667eea;
}
.detail-card.full-width {
grid-column: 1 / -1;
}
.detail-header {
display: flex;
align-items: center;
gap: 0.75rem;
margin-bottom: 1.25rem;
padding-bottom: 0.75rem;
border-bottom: 2px solid #e9ecef;
}
.detail-icon {
font-size: 1.5rem;
}
.detail-header h4 {
margin: 0;
font-size: 1.1rem;
color: #333;
}
.detail-item {
margin-bottom: 1rem;
}
.detail-item:last-child {
margin-bottom: 0;
}
.detail-item label {
display: block;
font-size: 0.75rem;
color: #999;
font-weight: 600;
text-transform: uppercase;
letter-spacing: 0.5px;
margin-bottom: 0.5rem;
}
.detail-value {
margin: 0;
color: #333;
font-size: 1rem;
}
.unknown-text {
color: #999;
font-style: italic;
}
.hash-container {
display: flex;
align-items: center;
gap: 0.75rem;
flex-wrap: wrap;
}
.full-hash {
font-family: 'Courier New', monospace;
font-size: 0.85rem;
color: #667eea;
background: white;
padding: 0.75rem;
border-radius: 6px;
word-break: break-all;
flex: 1;
min-width: 0;
}
.copy-hash-btn {
background: #667eea;
color: white;
border: none;
padding: 0.5rem 1rem;
border-radius: 6px;
cursor: pointer;
font-size: 0.9rem;
white-space: nowrap;
transition: all 0.2s;
}
.copy-hash-btn:hover {
background: #764ba2;
}
.description-full {
margin: 0;
color: #555;
line-height: 1.7;
font-size: 0.95rem;
}
.status-badge {
display: inline-block;
padding: 0.5rem 1rem;
border-radius: 20px;
font-weight: 600;
font-size: 0.9rem;
}
.status-submitted {
background: #d1ecf1;
color: #0c5460;
}
.status-analyzing {
background: #fff3cd;
color: #856404;
}
.status-in-progress {
background: #f8d7da;
color: #721c24;
}
.status-completed {
background: #d4edda;
color: #155724;
}
.detail-link {
color: #667eea;
text-decoration: none;
font-weight: 600;
display: inline-flex;
align-items: center;
gap: 0.25rem;
transition: color 0.2s;
}
.detail-link:hover {
color: #764ba2;
text-decoration: underline;
}
.no-link {
color: #999 !important;
font-style: italic;
}
/* Dark mode */
:root.dark .board-column {
background: linear-gradient(to bottom, #1a1a1a 0%, #2a2a2a 100%);
border-color: #444;
}
:root.dark .sample-card {
background: #2a2a2a;
border-left-color: #667eea;
}
:root.dark .title-text h4 {
color: #f5f5f5;
}
:root.dark .hash-short {
background: #1a1a1a;
color: #667eea;
}
:root.dark .description-text {
color: #ccc;
}
:root.dark .modal-content {
background: #1a1a1a;
}
:root.dark .modal-header {
background: linear-gradient(to right, #2a2a2a 0%, #1a1a1a 100%);
border-bottom-color: #444;
}
:root.dark .modal-header h3 {
color: #f5f5f5;
}
:root.dark .form-group input,
:root.dark .form-group textarea {
background: #2a2a2a;
border-color: #444;
color: #f5f5f5;
}
:root.dark .detail-card {
background: #2a2a2a;
}
:root.dark .full-hash {
background: #1a1a1a;
}
:root.dark .detail-value {
color: #f5f5f5;
}
:root.dark .context-menu,
:root.dark .move-menu {
background: #2a2a2a;
}
:root.dark .context-menu button,
:root.dark .move-menu button {
color: #f5f5f5;
}
:root.dark .context-menu button:hover,
:root.dark .move-menu button:hover {
background: #3a3a3a;
}
/* Mobile styles */
@media (max-width: 1200px) {
.board-columns {
grid-template-columns: repeat(2, 1fr);
}
}
@media (max-width: 768px) {
.board-columns {
grid-template-columns: 1fr;
}

.board-header {
  flex-direction: column;
  align-items: stretch;
}

.add-sample-btn {
  width: 100%;
  justify-content: center;
}

.sample-card {
  padding: 1rem;
}

.modal-content {
  max-height: 95vh;
}

form {
  padding: 1.5rem;
}

.detail-grid {
  grid-template-columns: 1fr;
}

.hash-container {
  flex-direction: column;
  align-items: stretch;
}

.copy-hash-btn {
  width: 100%;
}

.form-actions {
  flex-direction: column;
}

.btn-primary,
.btn-secondary {
  width: 100%;
  justify-content: center;
}
}
@media (max-width: 480px) {
.board-header h2 {
font-size: 1.5rem;
}
.title-text h4 {
  font-size: 1rem;
}

#cardDetailContent {
  padding: 1rem;
}
}
</style>